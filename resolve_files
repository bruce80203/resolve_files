#!/bin/bash

. .tracked.src # this sources .untracked_hard_coded.src

# MAIN

# function definitions from src file
ping_diskstation 		# if we are not able to ping diskstation the script will exit 1 here
edit_parameters
mount_file_system

for dir in $param_recs; do
    BKP_LABELS_ARRAY=(`echo $dir | tr '|' "\n"`)
    local_area=${BKP_LABELS_ARRAY[0]}
    mounted_area=${BKP_LABELS_ARRAY[1]}
    type=${BKP_LABELS_ARRAY[2]}
    if [[ $type == "main" ]]; then
        rev_type="copy"
    elif [[ $type == "copy" ]]; then
        rev_type="main"
    else
        echo "type is not set correctly must be main or copy"
        exit 1
    fi
    echo "sending compare $local_area $mounted_area $type"
    compare $local_area $mounted_area $type
    echo "sending compare $mounted_area $local_area $rev_type"
    compare $mounted_area $local_area $rev_type
done

echo "sleeping 3 seconds"
sleep 3
umount_file_system
echo "$total_count file comparisons made"
date
exit 0
